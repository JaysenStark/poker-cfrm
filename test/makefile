# c++ compiler with flag to
# keep symbols.
CXX = clang++ -g

# c++11 compilance and dependency gen 
# and disable c++98 compilance
CXXFLAGS  = -std=c++11 -MMD -MP

INCLUDES=-I ./include \
		-I /usr/local/freedom/include\

# add paths of libraries the
# targets depend on.
LIBRARIES = -L /usr/local/freedom/lib -lpoker -lecalc -lpthread\
			-lboost_program_options

# gather all source files and define
# where the object files of each target go.
CPP_FILES = $(wildcard *.cpp)
OBJ_FILES = $(addprefix obj/,$(notdir $(CPP_FILES:.cpp=.o)))
DEP_FILES = $(OBJ_FILES:.o=.d)

ifeq ($(target),debug)
	CXXFLAGS +=-O0 -Weverything -Wno-c++98-compat
else
    target = release
	CXXFLAGS +=-O3 -Wall
endif

OUT_BIN = test 

# implict targets to build source files
obj/%.o: %.cpp
	$(CXX) $(INCLUDES) $(CXXFLAGS) -c -o $@ $<

# link targets with their specific
# target options.
$(OUT_BIN): $(OBJ_FILES)
	$(CXX) $(INCLUDES) $(OBJ_FILES) $(LIBRARIES) -o $(OUT_BIN)

# target cleans all files generated by 
# the buildprocess.
clean:
	rm -f $(OBJ_FILES)
	rm -f $(DEP_FILES)
	rm -f $(OUT_BIN)

all: $(OUT_BIN) 

.PHONY: clean all run $(OUT_BIN)

-include $(DEP_FILES)
